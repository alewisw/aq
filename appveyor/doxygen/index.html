<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AQ: A Multi-Producer Concurrent Allocating Queue</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AQ
   &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Multi-Producer Concurrent Allocating Queue</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">A Multi-Producer Concurrent Allocating Queue </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The AQ library provides a queue data structure intended for use as an inter-thread and inter-process communications mechanism. The AQ data structure is suitable for situations where:</p><ul>
<li>All data storage for items in the queue must reside within the queue memory itself.</li>
<li>Multiple producers concurrent write items into the queue.</li>
<li>A single consumer reads and processes all items placed into the queue.</li>
</ul>
<p>The AQ has a number of features that make it particularly suitable for use as an inter-thread or inter-process communications mechanism; namely:</p><ul>
<li>Access to the queue (for any number of producers and a single consumer) is fully thread-safe using a lock-free algorithm.</li>
<li>The lock-free algorithm in turn means that there is no scheduler overhead induced by operating system locking primitives such as semaphores or mutexes.</li>
<li>The queue allocates memory for each item from its internal shared memory pool - no external memory management is required.</li>
<li>Two modes of operation are supported for memory allocation:<ul>
<li>Fixed length items consisting of a single contiguous memory regions.</li>
<li>Variable length items consisting of a linked-list of memory regions.</li>
</ul>
</li>
<li>The queue is robust in the face of unexpected application termination, especially when the application is in the middle of performing opertions on the queue.</li>
<li>The queue content can be fully captured and examined by taking a snapshot-in-time. This allow for recovery and examination of previously processed items in the case of unexpected application termination.</li>
</ul>
<h2>Internal Structure and Queue Algorithm</h2>
<p>In order to understand how to use the AQ interface a general understanding of the internal structure of the queue is required.</p><ul>
<li>A queue consists of an array of fixed size pages. The size of each page must be a power of two (i.e., 8, 16, 32, 64, 128, 256, etc bytes).</li>
<li>Multiple contiguous pages are grouped together to form an item.</li>
<li>Each item contains data supplied by the user and stored in the queue.</li>
<li>The status of each item is maintained by a control word. There is one control word per page in the queue.</li>
<li>The control word contains the following parameters:<ul>
<li>The number of pages in the item.</li>
<li>Whether the item has been claimed via a call to AQWriter::claim().</li>
<li>Whether the item has been committed via a call to AQWriter::commit().</li>
<li>Whether the item has been retrieved and then released by calling AQReader::retrieve() followed by AQReader::release().</li>
</ul>
</li>
<li>The queue maintains two pointers.<ul>
<li>The tail points to the page containing the start of the oldest unreleased item in the queue. An unreleased item is one that has not yet been passed to AQReader::release().</li>
<li>The head points to the oldest released page in the queue. The next item to be written will be stored at the head position. When the head and tail are equal to the queue is empty; when the head is exactly one less than the tail the queue is full. Thus in a full queue there is one page that is unusable for new allocation.</li>
</ul>
</li>
</ul>
<p>Shown below is an example of the queue data structure moving through a series of states. This example is described in detail below to help explain how the queue data is structured and the properties that this implies.</p>
<h3>Initial State</h3>
<p>In order to use an AQ, the application must supply a region of memory and then format that memory. The AQReader::format() function is used to format memory and takes a number of options to detemine how the queue behaves.</p><ul>
<li>The <code>pageSizeShift</code> parameter determines the size of the pages in the queue. The page size is the minimum allocation unit for the queue. If the page size is too large then space will be wasted as each item must consume at least one page. However if the page size is too small then memory is wasted in the per-page overhead (4 - 12 bytes depending on the formatting options). Page size is specified as a power of 2; thus if a <code>pageSizeShift</code> of 7 is specified then the actual page size will be 2^7 = 128 bytes.</li>
<li>The <code>commitTimeoutMs</code> defines the maximum time that any item can be claimed by a call to AQWriter::claim() without being committed by calling AQWriter::commit(). This time period exists to allow the queue to operate correctly if a writer crashes or otherwise malfunctions while holding a claimed item. In normal operation, failure to commit within this time period can result in data corruption so applications must be careful to only hold uncommitted items for the minimum time possible.</li>
<li>The <code>options</code> argument is a bit-mask of formatting options. These are defined in the AQ class. In this example the queue is formatted such that it has 15 pages of 2 bytes each. Having such small pages is not recommended in practice, however it is convenient for demonstration purposes. <div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mem[146];</div><div class="line"></div><div class="line">AQWriter writer(mem, <span class="keyword">sizeof</span>(mem));</div><div class="line">AQReader reader(mem, <span class="keyword">sizeof</span>(mem));</div><div class="line">reader.format(1, 500);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Page Size        = &quot;</span> &lt;&lt; reader.pageSize()  &lt;&lt; endl;    <span class="comment">// Page Size        = 2</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Page Count       = &quot;</span> &lt;&lt; reader.pageCount() &lt;&lt; endl;    <span class="comment">// Page Count       = 15</span></div></div><!-- fragment --> After formatting the queue items can be written to use <code>writer</code> and read from using <code>reader</code>. In this example we will assume that after some time the queue arrives in the state shown below:</li>
</ul>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#ffff66" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#bfbfbf" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#ffff66" valign="middle" align="center">4 </td><td bgcolor="#66ff66" valign="middle" align="center">5 </td><td bgcolor="#66ff66" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#ffff66" valign="middle" align="center">10 </td><td bgcolor="#bfbfbf" valign="middle" align="center">11 </td><td bgcolor="#bfbfbf" valign="middle" align="center">12 </td><td bgcolor="#bfbfbf" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve<br />
release </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="3">3 pages<br />
commit<br />
released </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#ffff66" valign="top" align="center">DD </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#ffff66" valign="top" align="center">HH </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="3">AA AA AA </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snapshot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 1<br />
released<br />
 </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 2<br />
incomplete<br />
released<br />
 </td><td bgcolor="#ffff66" valign="top" align="center">index 3 </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">index 4<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 5 </td><td bgcolor="#ff9933" valign="top" align="center">index 6<br />
incomplete </td><td bgcolor="#ffff66" valign="top" align="center">index 7 </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="3">Index 0<br />
released </td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td valign="top" align="center" colspan="3">3 pages </td><td colspan="8"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="4">4 pages </td><td width="0%"></td></tr>
</table>
<p>In this example there are a number of items in the queue that have been retrieved and released already, and a number that have yet to be retrieved or released. The items that exist in this queue are:</p><ol type="1">
<li>Position (11-13) - Head: Located at the head index is the oldest item in the queue, a 3 page item that has already been retrieved and released. After the three page item is a single page (page 14) of wasted space. Wasted space occurs when an allocation request is made that is larger than the number of contiguous pages available at the end of the queue, but can be satisified at the start of the queue. In this case a 2 page request was made but only 1 page was available. Thus we ended up with 1 page of wasted space.</li>
<li>Position (0-1): The next entry is a 2 page item that has also been retrieved and released.</li>
<li>Position (2-3): This entry is a 2 page item that has been retrieved and released. However this item was never committed (that is, it was claimed by calling AQWriter::claim() but never committed by calling AQWriter::commit()). This would be indicative of an unexpected termination before the item was committed or alternatly a bug in the application where the item was not committed before the commit timeout period was reached.</li>
<li>Position (4) - Tail: Located at the tail index is the oldest item in the queue that has not yet been returned by AQReader::retrieve(). This item has been committed so on the next call to AQReader::retrieve() it will be returned.</li>
<li>Position (5-6): The next entry is a 2 page item that has already been retrieved and released. As can be seen here items may be retrieved from the queue out-of-order. In this case it was due to the item at position (4) not yet been committed when the itm at position (5-6) was committed.</li>
<li>Position (7-8): A 2 page item that has been committed and retreived, but not yet released.</li>
<li>Position (9): A 1 page item that has been claimed but not yet committed back to the queue.</li>
<li>Position (10): A 1 page item that has been claimed and committed back to the queue.</li>
</ol>
<p>The current status of the queue can be obtained by taking a snapshot. Taking a snapshot is fully thread safe. </p><div class="fragment"><div class="line">AQSnapshot snap1(writer);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Number of Items  = &quot;</span> &lt;&lt; snap1.size() &lt;&lt; endl;          <span class="comment">// Number of Items  = 8</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0] Size     = &quot;</span> &lt;&lt; snap1[0].size() &lt;&lt; endl;       <span class="comment">// Item[0] Size     = 6</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0][0]       = &#39;&quot;</span> &lt;&lt; snap1[0][0] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;   <span class="comment">// Item[0][0]       = &#39;A&#39;</span></div></div><!-- fragment --><p> When taking a snapshot the status of the item can be obtained from the AQItem::isCommitted() and AQItem::isReleased() functions.</p>
<h3>AQWriter::claim() - claim a 1 page item</h3>
<p>The next step in the example is to claim a new item from the queue and write some data into that item. </p><div class="fragment"><div class="line">AQWriterItem item1;</div><div class="line">writer.claim(item1, 2);</div><div class="line">item1[0] = <span class="charliteral">&#39;I&#39;</span>;</div><div class="line">item1[1] = <span class="charliteral">&#39;I&#39;</span>;</div></div><!-- fragment --><p> When the item is claimed it is placed at the current head index, and the head index advances to the next unused position. In this case it causes the item formally located at position (11-13) to have its first page overwritten. The remaining pages still exist but are treated as unused within the queue. They are no longer available for snapshots.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#ffff66" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#ffff66" valign="middle" align="center">4 </td><td bgcolor="#66ff66" valign="middle" align="center">5 </td><td bgcolor="#66ff66" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#ffff66" valign="middle" align="center">10 </td><td bgcolor="#ff9933" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve<br />
release </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#ffff66" valign="top" align="center">DD </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#ffff66" valign="top" align="center">HH </td><td bgcolor="#ff9933" valign="top" align="center">ii </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#ffff66" valign="top" align="center">index 2 </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#ffff66" valign="top" align="center">index 6 </td><td bgcolor="#8f8f8f" valign="top" align="center"></td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td colspan="9"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<p>When the head index changes while a snapshot is being taken, the snapshot cannot rely on any pages that could be touched by the moving head index. Thus, if a snapshot was taken while the AQWriter::claim() was executing it may not include the newly allocated page, as shown above.</p>
<h3>AQWriter::commit() - commit the item previously claimed</h3>
<p>Now that an item has been obtained it needs to be committed back to the queue so that the AQReader can return it to the consumer. As previously mentioned it is critical for correct operation that the AQWriter::commit() occurs before the <code>commitTimeoutMs</code> passed to the AQReader::format() function (500ms in this example).</p>
<p>To commit the record back to the queue simply run the command: </p><div class="fragment"><div class="line">writer.commit(item1);</div></div><!-- fragment --><p> Note that the only change made to the queue is to mark the item as committed.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#ffff66" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#ffff66" valign="middle" align="center">4 </td><td bgcolor="#66ff66" valign="middle" align="center">5 </td><td bgcolor="#66ff66" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#ffff66" valign="middle" align="center">10 </td><td bgcolor="#ffff66" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve<br />
release </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#ffff66" valign="top" align="center">DD </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#ffff66" valign="top" align="center">HH </td><td bgcolor="#ffff66" valign="top" align="center">II </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#ffff66" valign="top" align="center">index 2 </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#ffff66" valign="top" align="center">index 6 </td><td bgcolor="#ffff66" valign="top" align="center">index 7 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td colspan="9"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<h3>AQReader::retrieve() - retrieve the next item</h3>
<p>In order to retrieve and item from the queue call AQReader::retrieve(). </p><div class="fragment"><div class="line">AQItem item2;</div><div class="line">reader.retrieve(item2);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item Size        = &quot;</span> &lt;&lt; item2.size() &lt;&lt; endl;          <span class="comment">// Item Size        = 2</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0]          = &#39;&quot;</span> &lt;&lt; item2[0] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;      <span class="comment">// Item[0]          = &#39;D&#39;</span></div></div><!-- fragment --><p> This retrieves the first available item from the queue; in this case the item located at position (4) which is the tail of the queue. The retrieval state for the item is recorded, however note that this is not stored in the queue itself. It is stored in private memory associated with the AQReader object. This in turn means that if the AQReader is destroyed and recreated then it will retrieve the same items again.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#99ffcc" valign="middle" align="center">4 </td><td bgcolor="#66ff66" valign="middle" align="center">5 </td><td bgcolor="#66ff66" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#ffff66" valign="middle" align="center">10 </td><td bgcolor="#ffff66" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve<br />
release </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#99ffcc" valign="top" align="center">DD </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#ffff66" valign="top" align="center">HH </td><td bgcolor="#ffff66" valign="top" align="center">II </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center">index 2 </td><td bgcolor="#66ff66" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#ffff66" valign="top" align="center">index 6 </td><td bgcolor="#ffff66" valign="top" align="center">index 7 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td colspan="9"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<h3>AQReader::release() - release the item previously retrieved</h3>
<p>Once the item has been processed by the consumer it needs to be released by calling AQReader::release(). </p><div class="fragment"><div class="line">reader.release(item2);</div></div><!-- fragment --><p> Releasing the item cause the tail to move passed all released items until it reaches the next unreleased item.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#bfbfbf" valign="middle" align="center">4 </td><td bgcolor="#bfbfbf" valign="middle" align="center">5 </td><td bgcolor="#bfbfbf" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#ffff66" valign="middle" align="center">10 </td><td bgcolor="#ffff66" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">1 page<br />
commit<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#bfbfbf" valign="top" align="center">DD </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#ffff66" valign="top" align="center">HH </td><td bgcolor="#ffff66" valign="top" align="center">II </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">index 2<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#ffff66" valign="top" align="center">index 6 </td><td bgcolor="#ffff66" valign="top" align="center">index 7 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="6">6 pages </td><td colspan="6"></td><td valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<h3>AQReader::retrieve() - start timer on uncommitted item and retrieve next item</h3>
<p>When a retrieve operation is performed, and an uncommitted item is enountered, a timer is started and the item is bypassed. </p><div class="fragment"><div class="line">AQItem item3;</div><div class="line">reader.retrieve(item3);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item Size        = &quot;</span> &lt;&lt; item3.size() &lt;&lt; endl;          <span class="comment">// Item Size        = 2</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0]          = &#39;&quot;</span> &lt;&lt; item3[0] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;      <span class="comment">// Item[0]          = &#39;H&#39;</span></div></div><!-- fragment --><p> In this case a timer is started on the item encountered on page 9 with the item on page 10 being returned.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#bfbfbf" valign="middle" align="center">4 </td><td bgcolor="#bfbfbf" valign="middle" align="center">5 </td><td bgcolor="#bfbfbf" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#99ffcc" valign="middle" align="center">10 </td><td bgcolor="#ffff66" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">1 page<br />
commit<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim<br />
xtimer-on </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ffff66" valign="top" align="center">1 page<br />
claim<br />
commit </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#bfbfbf" valign="top" align="center">DD </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#99ffcc" valign="top" align="center">HH </td><td bgcolor="#ffff66" valign="top" align="center">II </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">index 2<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#99ffcc" valign="top" align="center">index 6 </td><td bgcolor="#ffff66" valign="top" align="center">index 7 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="6">6 pages </td><td colspan="6"></td><td valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<h3>AQReader::retrieve() - retrieve after timer expires</h3>
<p>Given that the commit timeout expires the next retrieve only obtains the uncommitted item when the available space is less than 25% of the queue size. For example, even with the commit timeout expiring in the current queue state the now expired, uncommitted item is returned: </p><div class="fragment"><div class="line">sleep(1);</div><div class="line"></div><div class="line">AQItem item4;</div><div class="line">reader.retrieve(item4);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item Size        = &quot;</span> &lt;&lt; item4.size() &lt;&lt; endl;          <span class="comment">// Item Size        = 2</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0]          = &#39;&quot;</span> &lt;&lt; item4[0] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;      <span class="comment">// Item[0]          = &#39;I&#39;</span></div></div><!-- fragment --><table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#8f8f8f" width="6%" align="center">Head </td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#bfbfbf" valign="middle" align="center">0 </td><td bgcolor="#bfbfbf" valign="middle" align="center">1 </td><td bgcolor="#ff5050" valign="middle" align="center">2 </td><td bgcolor="#ff5050" valign="middle" align="center">3 </td><td bgcolor="#bfbfbf" valign="middle" align="center">4 </td><td bgcolor="#bfbfbf" valign="middle" align="center">5 </td><td bgcolor="#bfbfbf" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#99ffcc" valign="middle" align="center">10 </td><td bgcolor="#99ffcc" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">1 page<br />
commit<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim<br />
expired </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">unused </td><td bgcolor="#8f8f8f" valign="top" align="center">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">BB BB </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">cc cc </td><td bgcolor="#bfbfbf" valign="top" align="center">DD </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#99ffcc" valign="top" align="center">HH </td><td bgcolor="#99ffcc" valign="top" align="center">II </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f" valign="top" align="center">aa </td><td bgcolor="#8f8f8f"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#ff5050" valign="top" align="center" colspan="2">index 1<br />
incomplete<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center">index 2<br />
released </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 3<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 4 </td><td bgcolor="#ff9933" valign="top" align="center">index 5<br />
incomplete </td><td bgcolor="#99ffcc" valign="top" align="center">index 6 </td><td bgcolor="#99ffcc" valign="top" align="center">index 7 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td bgcolor="#cc66ff" valign="top" align="center" colspan="6">6 pages </td><td colspan="6"></td><td valign="top" align="center" colspan="3">3 pages </td><td width="0%"></td></tr>
</table>
<h3>AQWriter::claim() - claim an item that causes waste to appear</h3>
<p>In order to force the uncommitted item to be retrieved, add a new item to the list that requires 5 pages. </p><div class="fragment"><div class="line">AQWriterItem item5;</div><div class="line">writer.claim(item5, 10);</div><div class="line">item1[0] = <span class="charliteral">&#39;J&#39;</span>;</div></div><!-- fragment --><p> Note that this causes 4 pages of waste to be created at the end of the queue.</p>
<table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#bfbfbf" width="6%" align="center">Head </td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#ff9933" valign="middle" align="center">0 </td><td bgcolor="#ff9933" valign="middle" align="center">1 </td><td bgcolor="#ff9933" valign="middle" align="center">2 </td><td bgcolor="#ff9933" valign="middle" align="center">3 </td><td bgcolor="#ff9933" valign="middle" align="center">4 </td><td bgcolor="#bfbfbf" valign="middle" align="center">5 </td><td bgcolor="#bfbfbf" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff9933" valign="middle" align="center">9 </td><td bgcolor="#99ffcc" valign="middle" align="center">10 </td><td bgcolor="#99ffcc" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#ff9933" valign="top" align="center" colspan="5">5 pages<br />
claim </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff9933" valign="top" align="center">1 page<br />
claim<br />
expired </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#8f8f8f" valign="top" align="center" colspan="3">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#ff9933" valign="top" align="center" colspan="5">jj jj jj jj jj </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff9933" valign="top" align="center">gg </td><td bgcolor="#99ffcc" valign="top" align="center">HH </td><td bgcolor="#99ffcc" valign="top" align="center">II </td><td bgcolor="#8f8f8f" colspan="3"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#8f8f8f" valign="top" align="center" colspan="5"></td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 1 </td><td bgcolor="#ff9933" valign="top" align="center">index 2<br />
incomplete </td><td bgcolor="#99ffcc" valign="top" align="center">index 3 </td><td bgcolor="#99ffcc" valign="top" align="center">index 4 </td><td bgcolor="#8f8f8f" valign="top" align="center" colspan="3"></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td colspan="5"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="1">1 page </td><td colspan="9"></td><td width="0%"></td></tr>
</table>
<h3>AQReader::retrieve() - retrieve incomplete when queue is full and timer expires</h3>
<p>Now that the queue is less than 25% full the next item retrieved is the uncommitted item at index 9. </p><div class="fragment"><div class="line">AQItem item6;</div><div class="line">reader.retrieve(item6);</div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item Size        = &quot;</span> &lt;&lt; item6.size() &lt;&lt; endl;          <span class="comment">// Item Size        = 2</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Item[0]          = &#39;&quot;</span> &lt;&lt; item6[0] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; endl;      <span class="comment">// Item[0]          = &#39;G&#39;</span></div><div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Committed        = &quot;</span> &lt;&lt; item6.isCommitted() &lt;&lt; endl;   <span class="comment">// Committed        = 0</span></div></div><!-- fragment --><table class="doxtable">
<tr>
<td border="0" width="10%">Pointers: </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td bgcolor="#bfbfbf" width="6%" align="center">Head </td><td width="6%"></td><td bgcolor="#99ffcc" width="6%" align="center">Tail </td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td><td width="6%"></td></tr>
<tr>
<td border="0">Index: </td><td bgcolor="#ff9933" valign="middle" align="center">0 </td><td bgcolor="#ff9933" valign="middle" align="center">1 </td><td bgcolor="#ff9933" valign="middle" align="center">2 </td><td bgcolor="#ff9933" valign="middle" align="center">3 </td><td bgcolor="#ff9933" valign="middle" align="center">4 </td><td bgcolor="#bfbfbf" valign="middle" align="center">5 </td><td bgcolor="#bfbfbf" valign="middle" align="center">6 </td><td bgcolor="#99ffcc" valign="middle" align="center">7 </td><td bgcolor="#99ffcc" valign="middle" align="center">8 </td><td bgcolor="#ff5050" valign="middle" align="center">9 </td><td bgcolor="#99ffcc" valign="middle" align="center">10 </td><td bgcolor="#99ffcc" valign="middle" align="center">11 </td><td bgcolor="#8f8f8f" valign="middle" align="center">12 </td><td bgcolor="#8f8f8f" valign="middle" align="center">13 </td><td bgcolor="#8f8f8f" valign="middle" align="center">14 </td><td width="0%"></td></tr>
<tr>
<td border="0">Control: </td><td bgcolor="#ff9933" valign="top" align="center" colspan="5">5 pages<br />
claim </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">2 pages<br />
commit<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">2 pages<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#ff5050" valign="top" align="center">1 page<br />
claim<br />
retrieve </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#99ffcc" valign="top" align="center">1 page<br />
claim<br />
commit<br />
retrieve </td><td bgcolor="#8f8f8f" valign="top" align="center" colspan="3">waste </td><td width="0%"></td></tr>
<tr>
<td border="0">User Data: </td><td bgcolor="#ff9933" valign="top" align="center" colspan="5">jj jj jj jj jj </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">EE EE </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">FF FF </td><td bgcolor="#ff5050" valign="top" align="center">gg </td><td bgcolor="#99ffcc" valign="top" align="center">HH </td><td bgcolor="#99ffcc" valign="top" align="center">II </td><td bgcolor="#8f8f8f" colspan="3"></td><td width="0%"></td></tr>
<tr>
<td border="0">Snaphot: </td><td bgcolor="#ff9933" valign="top" align="center" colspan="5">index 5<br />
incomplete </td><td bgcolor="#bfbfbf" valign="top" align="center" colspan="2">index 0<br />
released </td><td bgcolor="#99ffcc" valign="top" align="center" colspan="2">index 1 </td><td bgcolor="#ff5050" valign="top" align="center">index 2<br />
incomplete </td><td bgcolor="#99ffcc" valign="top" align="center">index 3 </td><td bgcolor="#99ffcc" valign="top" align="center">index 4 </td><td></td><td></td><td></td><td width="0%"></td></tr>
<tr>
<td border="0">Available Size: </td><td colspan="5"></td><td bgcolor="#cc66ff" valign="top" align="center" colspan="1">1 page </td><td colspan="9"></td><td width="0%"></td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 1 2016 05:55:36 for AQ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
